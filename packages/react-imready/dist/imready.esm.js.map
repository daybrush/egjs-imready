{"version":3,"file":"imready.esm.js","sources":["../src/react-imready/useImReady.tsx","../src/react-imready/usePreReadyElement.tsx","../src/react-imready/useReadyElement.tsx","../src/react-imready/usePreReady.tsx","../src/react-imready/useReady.tsx"],"sourcesContent":["import { MutableRefObject, Ref, RefCallback, useEffect, useState } from \"react\";\nimport ImReady from \"@egjs/imready\";\nimport { ImReadyProps, ImReadyValue } from \"./types\";\n\n\nexport function useImReady(props: Partial<ImReadyProps> = {}): ImReadyValue {\n    const {\n        usePreReady = true,\n        usePreReadyElement = true,\n        useReady = true,\n        useReadyElement = true,\n        useError = true,\n        selector = \"\",\n        ...options\n    } = props;\n\n\n    const children: HTMLElement[] = [];\n    const [preReadyCount, setPreReadyCount] = useState(0);\n    const [readyCount, setReadyCount] = useState(0);\n    const [errorCount, setErrorCount] = useState(0);\n    const [totalErrorCount, setTotalErrorCount] = useState(0);\n    const [totalCount, setTotalCount] = useState(0);\n    const [isPreReady, setIsPreReady] = useState(false);\n    const [isReady, setIsReady] = useState(false);\n    const [hasError, setHasError] = useState(false);\n\n    function register<T extends HTMLElement>(ref?: Ref<T>) {\n        return (instance: T | null) => {\n            if (instance) {\n                children.push(instance);\n            }\n            if (!ref) {\n                return;\n            }\n            const refType = typeof ref;\n\n            if (refType === \"function\") {\n                (ref as RefCallback<T>)(instance);\n            } else {\n                (ref as MutableRefObject<T | null>).current = instance;\n            }\n        };\n    }\n\n    useEffect(() => {\n        const im = new ImReady(options);\n\n        let checkedElements = children;\n        if (selector) {\n            checkedElements = checkedElements.reduce((prev, cur) => {\n                return [...prev, ...cur.querySelectorAll<HTMLElement>(selector)];\n            }, [] as HTMLElement[]);\n;        }\n        im.check(checkedElements).on(\"error\", e => {\n            if (useError) {\n                setHasError(true);\n                setErrorCount(e.errorCount);\n                setTotalErrorCount(e.totalErrorCount);\n            }\n        }).on(\"preReadyElement\", e => {\n            if (usePreReadyElement) {\n                setPreReadyCount(e.preReadyCount);\n            }\n        }).on(\"readyElement\", e => {\n            if (useReadyElement) {\n                setReadyCount(e.readyCount);\n            }\n        }).on(\"preReady\", () => {\n            if (usePreReady) {\n                setIsPreReady(true);\n            }\n        }).on(\"ready\", () => {\n            if (useReady) {\n                setIsReady(true);\n            }\n        });\n        setTotalCount(im.getTotalCount());\n\n        return () => {\n            im.destroy();\n        };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    return {\n        preReadyCount,\n        readyCount,\n        totalCount,\n        errorCount,\n        totalErrorCount,\n        isPreReady,\n        isReady,\n        hasError,\n        register,\n    };\n}\n","import { ImReadyProps } from \"./types\";\nimport { useImReady } from \"./useImReady\";\n\nexport function usePreReadyElement(props: Partial<ImReadyProps> = {}) {\n    return useImReady({\n        useReady: false,\n        useReadyElement: false,\n        ...props,\n    });\n}\n","import { ImReadyProps } from \"./types\";\nimport { useImReady } from \"./useImReady\";\n\nexport function useReadyElement(props: Partial<ImReadyProps> = {}) {\n    return useImReady({\n        usePreReadyElement: false,\n        usePreReady: false,\n        ...props,\n    });\n}\n","import { ImReadyProps } from \"./types\";\nimport { useImReady } from \"./useImReady\";\n\nexport function usePreReady(props: Partial<ImReadyProps> = {}) {\n    return useImReady({\n        usePreReadyElement: false,\n        useReadyElement: false,\n        useReady: false,\n        ...props,\n    });\n}\n","import { ImReadyProps } from \"./types\";\nimport { useImReady } from \"./useImReady\";\n\nexport function useReady(props: Partial<ImReadyProps> = {}) {\n    return useImReady({\n        usePreReadyElement: false,\n        usePreReady: false,\n        useReadyElement: false,\n        ...props,\n    });\n}\n"],"names":["useImReady","props","_a","usePreReady","_b","usePreReadyElement","_c","useReady","_d","useReadyElement","_e","useError","_f","selector","options","children","_g","__read","useState","preReadyCount","setPreReadyCount","_h","readyCount","setReadyCount","_j","errorCount","setErrorCount","_k","totalErrorCount","setTotalErrorCount","_l","totalCount","setTotalCount","_m","isPreReady","setIsPreReady","_o","isReady","setIsReady","_p","hasError","setHasError","register","ref","instance","push","refType","current","useEffect","im","ImReady","checkedElements","reduce","prev","cur","querySelectorAll","check","on","e","getTotalCount","destroy"],"mappings":"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"}